# 井然（JingRan）项目系统性重构计划

## 阶段一：架构优化与代码重构（优先级：高）

### 1.1 数据模型简化与优化
- **重构LongTermTask实体**：将30+个字段拆分为核心字段和扩展属性表
- **优化数据关联**：建立清晰的长短期任务关联机制
- **添加数据库索引**：为常用查询字段添加索引，提升查询性能

### 1.2 依赖注入统一化
- **实现统一的手动DI容器**：创建DependencyInjectionModule统一管理依赖
- **标准化ViewModel初始化**：建立一致的ViewModel创建模式
- **清理冗余依赖**：移除未使用的Dagger依赖，简化项目结构

### 1.3 分层架构重构
- **明确Repository职责**：规范Repository层的数据访问逻辑
- **重构Service层**：将业务逻辑从Service层迁移到ViewModel或UseCase层
- **统一工具类管理**：创建utils包的统一入口点

## 阶段二：UI/UX全面重新设计（优先级：高）

### 2.1 主界面重构
- **统一iOS风格设计语言**：确保所有UI组件遵循iOS设计规范
- **优化SmartPlanningFragment布局**：
  - 移除NestedScrollView嵌套，改用ConstraintLayout优化性能
  - 重新设计统计信息区域，使用卡片式布局替代GridLayout
  - 优化按钮排列，建立清晰的视觉层次
- **增强空状态设计**：为所有列表添加空状态提示和引导

### 2.2 导航流程优化
- **重构MainActivity导航**：统一ViewPager和底部导航的页面数量
- **优化任务编辑流程**：简化任务类型选择，提供快速添加入口
- **增强任务完成反馈**：添加动画效果和即时反馈

### 2.3 日程管理UI增强
- **实现日历视图**：添加月视图和周视图展示日程
- **优化课程表展示**：改进固定日程的视觉呈现
- **添加日程冲突提示**：在UI中直观展示时间冲突

## 阶段三：智能规划功能完善（优先级：高）

### 3.1 智能规划算法增强
- **实现用户偏好学习**：记录用户习惯，优化任务排序
- **完善紧急任务处理**：集成紧急任务插入逻辑到主流程
- **添加自动重新规划**：任务完成后自动调整后续计划

### 3.2 课程表导入功能完善
- **增强Excel导入**：支持真正的.xlsx格式解析
- **实现OCR功能**：集成ML Kit实现课程表图片识别
- **添加数据验证**：完善导入数据的校验和错误处理

### 3.3 日程冲突检测
- **实现冲突检测算法**：自动识别时间冲突
- **提供冲突解决方案**：给出调整建议
- **添加冲突提醒**：在UI中突出显示冲突项

## 阶段四：性能优化与测试完善（优先级：中）

### 4.1 性能优化
- **实现分页加载**：为RecyclerView添加分页支持
- **优化数据库查询**：使用索引和查询优化
- **减少内存占用**：优化图片加载和缓存策略

### 4.2 测试覆盖完善
- **单元测试**：为关键业务逻辑添加单元测试
- **集成测试**：完善数据层和UI层的集成测试
- **UI测试**：添加Espresso测试覆盖主要用户流程

## 阶段五：文档与代码质量提升（优先级：中）

### 5.1 代码质量提升
- **统一代码风格**：应用Kotlin编码规范
- **添加代码注释**：为复杂逻辑添加详细注释
- **重构重复代码**：提取公共逻辑到工具类

### 5.2 文档完善
- **API文档**：为公共接口添加文档
- **架构文档**：更新项目架构说明
- **用户手册**：完善功能使用说明

## 实施顺序建议

1. **第一周**：完成阶段一的架构优化
2. **第二周**：完成阶段二的UI/UX重构
3. **第三周**：完成阶段三的智能规划功能完善
4. **第四周**：完成阶段四和五的性能优化与测试完善

## 预期成果

- **代码质量**：架构清晰，易于维护和扩展
- **用户体验**：界面美观，操作流畅直观
- **功能完整**：智能规划算法完善，日程管理功能齐全
- **性能优异**：响应迅速，内存占用合理
- **测试充分**：覆盖全面，稳定性高